<div style="font-size:0.875em; padding:10px">
  <details>
    <summary style="color: blue">Help</summary>
    URL query parameter options:
    <ul>
      <li><code><%= link_to('show_pii', {action: 'show', show_pii: ""}) %></code>: shows PII in the Intake section</li>
      <li><code><%= link_to('fields=id,status,updated_at', {action: 'show', fields: "id,status,updated_at"}) %></code>: custom fields to show in the Task tree section</li>
    </ul>
    <div id="treeefields" style="width: 200px; height: 300px; overflow-y: scroll; padding:10px">
      <% available_fields.each do |field_name| %>
        <% if treee_fields.include?(field_name.to_sym) %>
          <input type="checkbox" name="<%=field_name%>" id="<%=field_name%>" checked />
        <% else %>
          <input type="checkbox" name="<%=field_name%>" id="<%=field_name%>" />
        <% end %>
        <label for="<%=field_name%>"><%=field_name%></label>
      <% end %>
    </div>
    <p/><a id="task_tree_link" href="">Update task tree</a>

    <p/>Other formats:
    <%= link_to('text', {action: 'show', format: "text"}) %>, 
    <%= link_to('json', {action: 'show', format: "json"}) %>
    <hr/>
  </details>

  <h3>Task tree</h3>
  <code style="color: green">
    Appeal.find(<%= appeal.id %>).treee
      (<%= treee_fields.map{|f| f.to_s.prepend(":")}.join(", ") %>)
    <% if appeal.is_a?(LegacyAppeal) %>
      <br/>la = LegacyWorkQueue.tasks_by_appeal_id(<%= appeal.vacols_id %>)
      <br/>la.location_history.map(&:summary)
    <% end %>
  </code>
  <pre><code><%= task_tree_as_text %></code></pre>
  <hr/>

  <h3>Intake</h3>
  <code style="color: green">
    puts IntakeRenderer.render(Appeal.find(<%= appeal.id %>), 
      show_pii: <%= show_pii_query_param ? "true" : "false" %>)
  </code>
  <pre><code><%= intake_as_text %></code></pre>
  <hr/>

  <h3>Network graph</h3>
  <div id="mynetwork"></div>
  <pre><code><%= JSON.pretty_generate(network_graph_data) %></code></pre>
  TODO: https://visjs.github.io/vis-network/examples/network/data/dynamicFiltering.html

  <%= javascript_include_tag 'export-appeal' %>
  <script type="text/javascript">
    $('#treeefields input').change(function(){
      var selected = [];
      $('#treeefields input:checked').each(function() {
          selected.push($(this).attr('name'));
      });
      $('#task_tree_link').attr("href", window.location.href.split('?')[0]+"?fields="+selected.join(','));
    });

    var network_graph_data = <%= network_graph_data.to_json.html_safe %>;
    var nodes = new vis.DataSet(network_graph_data["nodes"]);
    var edges = new vis.DataSet(network_graph_data["edges"]);

    var container = document.getElementById("mynetwork");
    var data = {
      nodes: nodes,
      edges: edges,
    };
    var options = {
      height: '500px',
      clickToUse: true,
      edges: {
        arrows: 'to'
      }
    };
    var network = new vis.Network(container, data, options);
  </script>
</div>
